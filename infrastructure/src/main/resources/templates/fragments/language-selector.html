<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--
  Language selector fragment.
  Include in templates with: <div th:replace="~{fragments/language-selector :: selector}"></div>
-->

<!-- Language selector with all supported languages -->
<div th:fragment="selector" class="language-selector">
    <a th:href="@{''(lang='en')}" th:classappend="${#locale.language == 'en' ? 'active' : ''}" 
       onclick="saveLanguagePreference('en')" title="English">ğŸ‡¬ğŸ‡§</a>
    <a th:href="@{''(lang='no')}" th:classappend="${#locale.language == 'no' ? 'active' : ''}" 
       onclick="saveLanguagePreference('no')" title="Norsk">ğŸ‡³ğŸ‡´</a>
    <a th:href="@{''(lang='de')}" th:classappend="${#locale.language == 'de' ? 'active' : ''}" 
       onclick="saveLanguagePreference('de')" title="Deutsch">ğŸ‡©ğŸ‡ª</a>
    <a th:href="@{''(lang='es')}" th:classappend="${#locale.language == 'es' ? 'active' : ''}" 
       onclick="saveLanguagePreference('es')" title="EspaÃ±ol">ğŸ‡ªğŸ‡¸</a>
    <a th:href="@{''(lang='fr')}" th:classappend="${#locale.language == 'fr' ? 'active' : ''}" 
       onclick="saveLanguagePreference('fr')" title="FranÃ§ais">ğŸ‡«ğŸ‡·</a>
    <a th:href="@{''(lang='it')}" th:classappend="${#locale.language == 'it' ? 'active' : ''}" 
       onclick="saveLanguagePreference('it')" title="Italiano">ğŸ‡®ğŸ‡¹</a>
    <a th:href="@{''(lang='ja')}" th:classappend="${#locale.language == 'ja' ? 'active' : ''}" 
       onclick="saveLanguagePreference('ja')" title="æ—¥æœ¬èª">ğŸ‡¯ğŸ‡µ</a>
    <a th:href="@{''(lang='pl')}" th:classappend="${#locale.language == 'pl' ? 'active' : ''}" 
       onclick="saveLanguagePreference('pl')" title="Polski">ğŸ‡µğŸ‡±</a>
    <a th:href="@{''(lang='pt')}" th:classappend="${#locale.language == 'pt' ? 'active' : ''}" 
       onclick="saveLanguagePreference('pt')" title="PortuguÃªs">ğŸ‡§ğŸ‡·</a>
</div>

<!-- JavaScript for saving language preference (include once per page) -->
<script th:fragment="script">
/**
 * Save language preference to server if user is logged in.
 * The page will reload with the new language regardless.
 */
function saveLanguagePreference(lang) {
    // Fire and forget - the page will reload anyway via the href
    fetch('/api/preferences/language', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ language: lang }),
    }).catch(() => {
        // Ignore errors - user might not be logged in, which is fine
        // The cookie-based fallback will handle non-logged-in users
    });
}
</script>

<!-- CSS styles for language selector (include in your page styles) -->
<style th:fragment="styles">
.language-selector {
    display: flex;
    align-items: center;
    gap: 2px;
}
.language-selector a {
    text-decoration: none;
    font-size: 1.3em;
    padding: 2px 4px;
    border-radius: 4px;
    opacity: 0.5;
    transition: opacity 0.2s, transform 0.2s;
}
.language-selector a:hover {
    opacity: 0.8;
    transform: scale(1.1);
}
.language-selector a.active {
    opacity: 1;
}
</style>

</html>
